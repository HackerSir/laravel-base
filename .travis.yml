language: php
dist: trusty
sudo: false

services:
  - redis-server

cache:
  directories:
    - $HOME/.composer/cache/files

php:
  - '7.0'
  - '7.1'

before_install:
  - sudo apt-get install -y software-properties-common
  - sudo apt-key -y adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xcbcb082a1bb943db
  - sudo add-apt-repository -y 'deb [arch=amd64,i386,ppc64el] http://sgp1.mirrors.digitalocean.com/mariadb/repo/10.2/ubuntu trusty main'
  - sudo apt-get update -y
  - sudo apt-get install -y -o Dpkg::Options::='--force-confnew' mariadb-server

before_script:
  - phpenv config-rm xdebug.ini
  - cp .env.travis .env
  - composer self-update
  - composer install --prefer-dist --optimize-autoloader --quiet
  - php artisan key:generate
  - mysql -e 'CREATE DATABASE travis_test DEFAULT CHARACTER SET utf8mb4 DEFAULT COLLATE utf8mb4_unicode_ci;'
  - php artisan migrate

after_success:
  - bash <(curl -s https://codecov.io/bash)

script:
  - phpdbg -qrr vendor/bin/phpunit

notifications:
  email:
    recipients:
      - hackersir-developer@googlegroups.com
    on_success: change
    on_failure: always
